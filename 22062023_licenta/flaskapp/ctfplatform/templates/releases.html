{% extends "base.html" %}
{% block content %}
  <h1 class="title">
    Releases
  </h1>
  <div class="container">
    <div class="box">
      <table class="table is-fullwidth">
        <thead>
          <tr>
            <th>Name</th>
            <th>Version</th>
            <th>Created At</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% set unique_names = [] %}
          {% for release in releases %}
            {% if release["name"] not in unique_names %}
              {% set unique_names = unique_names + [release["name"]] %}
              <tr>
                <td>{{ release["name"] }}</td>
                <td>{{ release["version"] }}</td>
                <td>{{ release["created"] }}</td>
                <td>
                  <div class="buttons">
                    <form id="form_{{ release.name }}" method="POST" action="{{ url_for('main.releases') }}">
                      <input type="hidden" name="release-name" value="{{ release.name }}">
                      <input type="hidden" name="release-version" value="{{ release.version }}">
                      <button id="install_button_{{ release.name }}" type="submit" class="button is-success install-button" name="action" value="apply_release">Install</button>
                      <button id="uninstall_button_{{ release.name }}" type="submit" class="button is-danger uninstall-button" name="action" value="uninstall_release" data-installed="False">Uninstall</button>
                      <button type="submit" class="button is-success" name="action" value="authorize_users">Authorize Users</button>
                      <button type="submit" class="button is-danger" name="action" value="delete_release">Delete</button>
                      <button type="submit" class="button is-info" name="action" value="rollout">Rollout</button>
                    </form>
                  </div>
                </td>
              </tr>
            {% endif %}
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}
{% block scripts %}
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="{{ url_for('static', filename='install_uninstall.js') }}"></script>
{% endblock %}
